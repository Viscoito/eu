const translations = {
  pt: {
    "nav.language": "Idioma",
    "nav.themeDark": "ðŸŒ™ Escuro",
    "nav.themeLight": "â˜€ï¸ Claro",
    "tabs.home": "Home",
    "tabs.about": "Sobre",
    "tabs.projects": "Projetos",
    "tabs.gallery": "Artes",
    "tabs.vtuber": "VTuber",
    "tabs.contact": "Contato",
    "hero.badge": "Desenvolvedor Criativo â€¢ Artista Digital",
    "hero.short":
      "Crio soluÃ§Ãµes digitais que misturam lÃ³gica, estÃ©tica e interatividade. Um resumo rÃ¡pido aqui; detalhes nas seÃ§Ãµes abaixo.",
    "hero.q1": "CÃ³digo + Criatividade",
    "hero.q1d": "AutomaÃ§Ã£o, web apps e arte digital no mesmo fluxo.",
    "hero.q2": "Pesquisa aplicada",
    "hero.q2d": "Estudo antes de construir para reduzir retrabalho.",
    "hero.q3": "Live2D ready",
    "hero.q3d": "Base preparada para integraÃ§Ã£o com Cubism.",
    "about.title": "Sobre mim",
    "about.text1":
      "Desde 2010, integro cÃ³digo e criatividade para criar ferramentas funcionais e experiÃªncias visuais de qualidade.",
    "about.text2":
      "Perfil autodidata, adaptaÃ§Ã£o rÃ¡pida em ambientes remotos e foco em transformar ideias em soluÃ§Ãµes objetivas.",
    "projects.title": "Projetos em destaque",
    "projects.p1.title": "Bots para comunidades",
    "projects.p1.text":
      "Chatbots para IRC com coleta de dados e melhoria de precisÃ£o.",
    "projects.p2.title": "Fluxos com IA",
    "projects.p2.text":
      "Refino de prompts/scripts para acelerar produÃ§Ã£o criativa e tÃ©cnica.",
    "projects.p3.title": "Pipeline de arte + Live2D",
    "projects.p3.text":
      "Assets visuais e modelos Live2D com padrÃ£o de qualidade.",
    "projects.p4.title": "Sites com visual premium",
    "projects.p4.text":
      "Interfaces fluidas inspiradas na Apple com foco em experiÃªncia.",
    "gallery.title": "Galeria de artes",
    "gallery.text": "Galeria maior para ilustraÃ§Ãµes, concept art e renders.",
    "vtuber.title": "VTuber Live2D",
    "vtuber.text":
      "IntegraÃ§Ã£o preparada: se vocÃª adicionar um arquivo `assets/live2d/model.model3.json`, o site tenta carregar automaticamente um canvas para interaÃ§Ã£o.",
    "vtuber.statusIdle": "Aguardando modelo Live2D local.",
    "vtuber.statusLoading": "Tentando carregar modelo Live2D...",
    "vtuber.statusMissing":
      "Modelo nÃ£o encontrado. Adicione assets/live2d/model.model3.json",
    "vtuber.statusReady":
      "Modelo Live2D detectado. PrÃ³xima etapa: ligar runtime Cubism.",
    "vtuber.hint":
      "Dica: por limitaÃ§Ã£o de acesso remoto, o repo externo pode falhar; entÃ£o deixei fallback local pronto.",
    "contact.title": "Contato",
    "contact.text":
      "Vamos conversar sobre freelas, projetos, arte digital ou Live2D.",
  },
  en: {
    "nav.language": "Language",
    "nav.themeDark": "ðŸŒ™ Dark",
    "nav.themeLight": "â˜€ï¸ Light",
    "tabs.home": "Home",
    "tabs.about": "About",
    "tabs.projects": "Projects",
    "tabs.gallery": "Art",
    "tabs.vtuber": "VTuber",
    "tabs.contact": "Contact",
    "hero.badge": "Creative Developer â€¢ Digital Artist",
    "hero.short":
      "I build digital solutions blending logic, aesthetics, and interactivity. Quick summary here; details below.",
    "hero.q1": "Code + Creativity",
    "hero.q1d": "Automation, web apps, and digital art in one pipeline.",
    "hero.q2": "Applied research",
    "hero.q2d": "Research-first approach to reduce rework.",
    "hero.q3": "Live2D ready",
    "hero.q3d": "Foundation ready for Cubism integration.",
    "about.title": "About me",
    "about.text1":
      "Since 2010, I blend code and creativity to build functional tools and quality visual experiences.",
    "about.text2":
      "Self-taught profile, fast remote adaptation, and focus on practical solutions.",
    "projects.title": "Featured projects",
    "projects.p1.title": "Community bots",
    "projects.p1.text":
      "IRC chatbots with data collection and improved accuracy.",
    "projects.p2.title": "AI workflows",
    "projects.p2.text":
      "Prompt/script refinement to speed up creative and technical work.",
    "projects.p3.title": "Art + Live2D pipeline",
    "projects.p3.text":
      "Visual assets and Live2D models with quality standards.",
    "projects.p4.title": "Premium-feel websites",
    "projects.p4.text":
      "Fluid Apple-inspired interfaces focused on experience.",
    "gallery.title": "Art gallery",
    "gallery.text":
      "Larger gallery for illustrations, concept art, and renders.",
    "vtuber.title": "VTuber Live2D",
    "vtuber.text":
      "Integration-ready: if you add `assets/live2d/model.model3.json`, the site will try to auto-load a stage canvas.",
    "vtuber.statusIdle": "Waiting for local Live2D model.",
    "vtuber.statusLoading": "Trying to load Live2D model...",
    "vtuber.statusMissing":
      "Model not found. Add assets/live2d/model.model3.json",
    "vtuber.statusReady":
      "Live2D model detected. Next step: connect Cubism runtime.",
    "vtuber.hint":
      "Tip: external repository access may fail in remote environments; local fallback is ready.",
    "contact.title": "Contact",
    "contact.text":
      "Letâ€™s talk about freelance, projects, digital art, or Live2D.",
  },
  es: {
    "nav.language": "Idioma",
    "nav.themeDark": "ðŸŒ™ Oscuro",
    "nav.themeLight": "â˜€ï¸ Claro",
    "tabs.home": "Inicio",
    "tabs.about": "Sobre mÃ­",
    "tabs.projects": "Proyectos",
    "tabs.gallery": "Arte",
    "tabs.vtuber": "VTuber",
    "tabs.contact": "Contacto",
    "hero.badge": "Desarrollador Creativo â€¢ Artista Digital",
    "hero.short":
      "Creo soluciones digitales combinando lÃ³gica, estÃ©tica e interactividad. Resumen aquÃ­; detalles abajo.",
    "hero.q1": "CÃ³digo + Creatividad",
    "hero.q1d": "AutomatizaciÃ³n, apps web y arte digital en un flujo.",
    "hero.q2": "InvestigaciÃ³n aplicada",
    "hero.q2d": "Investigar antes de construir reduce retrabajo.",
    "hero.q3": "Live2D ready",
    "hero.q3d": "Base lista para integrar Cubism.",
    "about.title": "Sobre mÃ­",
    "about.text1":
      "Desde 2010, combino cÃ³digo y creatividad para crear herramientas funcionales y experiencias visuales.",
    "about.text2":
      "Perfil autodidacta, adaptaciÃ³n rÃ¡pida en remoto y foco en soluciones prÃ¡cticas.",
    "projects.title": "Proyectos destacados",
    "projects.p1.title": "Bots para comunidades",
    "projects.p1.text":
      "Chatbots IRC con recolecciÃ³n de datos y mejor precisiÃ³n.",
    "projects.p2.title": "Flujos con IA",
    "projects.p2.text":
      "Refino de prompts/scripts para acelerar trabajo creativo y tÃ©cnico.",
    "projects.p3.title": "Pipeline arte + Live2D",
    "projects.p3.text":
      "Assets visuales y modelos Live2D con estÃ¡ndar de calidad.",
    "projects.p4.title": "Sitios estilo premium",
    "projects.p4.text":
      "Interfaces fluidas inspiradas en Apple con foco en experiencia.",
    "gallery.title": "GalerÃ­a de arte",
    "gallery.text":
      "GalerÃ­a mÃ¡s grande para ilustraciones, concept art y renders.",
    "vtuber.title": "VTuber Live2D",
    "vtuber.text":
      "IntegraciÃ³n preparada: si agregas `assets/live2d/model.model3.json`, el sitio intentarÃ¡ cargar un canvas automÃ¡ticamente.",
    "vtuber.statusIdle": "Esperando modelo Live2D local.",
    "vtuber.statusLoading": "Intentando cargar modelo Live2D...",
    "vtuber.statusMissing":
      "Modelo no encontrado. Agrega assets/live2d/model.model3.json",
    "vtuber.statusReady":
      "Modelo detectado. PrÃ³ximo paso: conectar runtime Cubism.",
    "vtuber.hint":
      "Tip: el acceso al repositorio externo puede fallar; dejÃ© fallback local listo.",
    "contact.title": "Contacto",
    "contact.text":
      "Hablemos sobre freelance, proyectos, arte digital o Live2D.",
  },
  ja: {
    "nav.language": "è¨€èªž",
    "nav.themeDark": "ðŸŒ™ ãƒ€ãƒ¼ã‚¯",
    "nav.themeLight": "â˜€ï¸ ãƒ©ã‚¤ãƒˆ",
    "tabs.home": "ãƒ›ãƒ¼ãƒ ",
    "tabs.about": "è‡ªå·±ç´¹ä»‹",
    "tabs.projects": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ",
    "tabs.gallery": "ã‚¢ãƒ¼ãƒˆ",
    "tabs.vtuber": "VTuber",
    "tabs.contact": "é€£çµ¡å…ˆ",
    "hero.badge": "ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–é–‹ç™ºè€… â€¢ ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ",
    "hero.short":
      "ãƒ­ã‚¸ãƒƒã‚¯ãƒ»ç¾Žã—ã•ãƒ»ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’çµ„ã¿åˆã‚ã›ãŸåˆ¶ä½œã‚’è¡Œã„ã¾ã™ã€‚ã“ã“ã¯è¦ç´„ã€ä¸‹ã§è©³ç´°ã§ã™ã€‚",
    "hero.q1": "ã‚³ãƒ¼ãƒ‰ + å‰µé€ æ€§",
    "hero.q1d": "è‡ªå‹•åŒ–ãƒ»Webãƒ»ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¢ãƒ¼ãƒˆã‚’ä¸€ã¤ã®æµã‚Œã§ã€‚",
    "hero.q2": "å¿œç”¨ãƒªã‚µãƒ¼ãƒ",
    "hero.q2d": "å…ˆã«èª¿æŸ»ã—ã¦æ‰‹æˆ»ã‚Šã‚’æ¸›ã‚‰ã—ã¾ã™ã€‚",
    "hero.q3": "Live2D ready",
    "hero.q3d": "Cubismçµ±åˆã®ãŸã‚ã®åœŸå°ã‚’æº–å‚™æ¸ˆã¿ã€‚",
    "about.title": "è‡ªå·±ç´¹ä»‹",
    "about.text1":
      "2010å¹´ã‹ã‚‰ã€ã‚³ãƒ¼ãƒ‰ã¨å‰µé€ æ€§ã‚’èžåˆã—ã€æ©Ÿèƒ½çš„ãªãƒ„ãƒ¼ãƒ«ã¨é«˜å“è³ªãªä½“é¨“ã‚’åˆ¶ä½œã€‚",
    "about.text2": "ç‹¬å­¦ã€ãƒªãƒ¢ãƒ¼ãƒˆé©å¿œã€å®Ÿç”¨çš„ãªè§£æ±ºã«å¼·ã¿ãŒã‚ã‚Šã¾ã™ã€‚",
    "projects.title": "æ³¨ç›®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ",
    "projects.p1.title": "ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£å‘ã‘ãƒœãƒƒãƒˆ",
    "projects.p1.text": "ãƒ‡ãƒ¼ã‚¿åŽé›†ã¨ç²¾åº¦æ”¹å–„ã‚’å‚™ãˆãŸIRCãƒœãƒƒãƒˆã€‚",
    "projects.p2.title": "AIãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼",
    "projects.p2.text": "ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ/ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ”¹å–„ã§åˆ¶ä½œã‚’é«˜é€ŸåŒ–ã€‚",
    "projects.p3.title": "ã‚¢ãƒ¼ãƒˆ + Live2D ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³",
    "projects.p3.text": "å“è³ªåŸºæº–ã«æ²¿ã£ãŸãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«è³‡ç”£ã¨Live2Dåˆ¶ä½œã€‚",
    "projects.p4.title": "ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚µã‚¤ãƒˆ",
    "projects.p4.text": "Appleé¢¨ã®æ»‘ã‚‰ã‹ãªUIã§ä½“é¨“é‡è¦–ã€‚",
    "gallery.title": "ã‚¢ãƒ¼ãƒˆã‚®ãƒ£ãƒ©ãƒªãƒ¼",
    "gallery.text": "ã‚¤ãƒ©ã‚¹ãƒˆã€ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚¢ãƒ¼ãƒˆã€ãƒ¬ãƒ³ãƒ€ã®å¤§ãã‚ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã€‚",
    "vtuber.title": "VTuber Live2D",
    "vtuber.text":
      "`assets/live2d/model.model3.json` ã‚’è¿½åŠ ã™ã‚‹ã¨ã€ã‚µã‚¤ãƒˆãŒè‡ªå‹•ãƒ­ãƒ¼ãƒ‰ã‚’è©¦ã¿ã¾ã™ã€‚",
    "vtuber.statusIdle": "ãƒ­ãƒ¼ã‚«ãƒ«Live2Dãƒ¢ãƒ‡ãƒ«å¾…æ©Ÿä¸­ã€‚",
    "vtuber.statusLoading": "Live2Dãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...",
    "vtuber.statusMissing":
      "ãƒ¢ãƒ‡ãƒ«æœªæ¤œå‡ºã€‚assets/live2d/model.model3.json ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚",
    "vtuber.statusReady": "ãƒ¢ãƒ‡ãƒ«æ¤œå‡ºã€‚æ¬¡ã¯Cubismãƒ©ãƒ³ã‚¿ã‚¤ãƒ æŽ¥ç¶šã§ã™ã€‚",
    "vtuber.hint":
      "å¤–éƒ¨ãƒªãƒã‚¸ãƒˆãƒªã‚¢ã‚¯ã‚»ã‚¹ãŒå¤±æ•—ã™ã‚‹å ´åˆãŒã‚ã‚‹ãŸã‚ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚",
    "contact.title": "é€£çµ¡å…ˆ",
    "contact.text":
      "ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¢ãƒ¼ãƒˆã€Live2Dã®ç›¸è«‡æ­“è¿Žã§ã™ã€‚",
  },
};

const langSelect = document.getElementById("langSelect");
const themeToggle = document.getElementById("themeToggle");
const translatable = document.querySelectorAll("[data-i18n]");
const sectionLinks = document.querySelectorAll(".topnav a");
const revealNodes = document.querySelectorAll(".reveal");
const vtuberStatus = document.getElementById("vtuberStatus");

function t(key) {
  const lang = langSelect.value || "pt";
  return (translations[lang] || translations.pt)[key] || key;
}

function applyLanguage(lang) {
  const dict = translations[lang] || translations.pt;
  document.documentElement.lang = lang;
  translatable.forEach((node) => {
    const key = node.dataset.i18n;
    if (dict[key]) node.textContent = dict[key];
  });
  updateThemeLabel();
  localStorage.setItem("portfolio-lang", lang);
}

function setTheme(theme) {
  document.body.dataset.theme = theme;
  localStorage.setItem("portfolio-theme", theme);
  updateThemeLabel();
}

function updateThemeLabel() {
  themeToggle.textContent =
    document.body.dataset.theme === "dark"
      ? t("nav.themeLight")
      : t("nav.themeDark");
}

langSelect.addEventListener("change", (e) => applyLanguage(e.target.value));
themeToggle.addEventListener("click", () =>
  setTheme(document.body.dataset.theme === "dark" ? "light" : "dark"),
);

const sectionObserver = new IntersectionObserver(
  (entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) entry.target.classList.add("visible");
    });
  },
  { threshold: 0.12 },
);
revealNodes.forEach((node) => sectionObserver.observe(node));

const navObserver = new IntersectionObserver(
  (entries) => {
    entries.forEach((entry) => {
      if (!entry.isIntersecting) return;
      sectionLinks.forEach((link) =>
        link.classList.toggle(
          "active",
          link.getAttribute("href") === `#${entry.target.id}`,
        ),
      );
    });
  },
  { rootMargin: "-30% 0px -55% 0px", threshold: 0.01 },
);
document
  .querySelectorAll("main section[id]")
  .forEach((sec) => navObserver.observe(sec));

const savedLang = localStorage.getItem("portfolio-lang") || "pt";
const savedTheme = localStorage.getItem("portfolio-theme") || "dark";
langSelect.value = savedLang;
setTheme(savedTheme);
applyLanguage(savedLang);

const cubismModel = "./assets/live2d/Visnhaa/Visnha.model3.json";

(async function main() {
  const app = new PIXI.Application({
    view: document.getElementById("canvas"),
    autoStart: true,
    // resizeTo: window,
    backgroundAlpha: 0,
    width: "400",
    height: "400",
  });
  const model = await PIXI.live2d.Live2DModel.from(cubismModel);
  app.stage.addChild(model);
  model.scale.set(0.1);

  // const margin = -60;

  // function positionBottomRight() {
  //   model.x = 0;

  //   const bounds = model.getBounds();

  //   model.x = app.screen.width - bounds.width - margin - bounds.x;
  // }

  // requestAnimationFrame(positionBottomRight);

  // window.addEventListener("resize", () => {
  //   requestAnimationFrame(positionBottomRight);
  // });
  model.pivot.set(model.width / 2, model.height - 2500);

  // app.stage.on("pointermove", (e) => {
  //   const pos = e.data.global;

  //   const faceX = model.x;
  //   const faceY = model.y - model.height * 0.5;

  //   model.focus(pos.x - faceX, pos.y - faceY);
  // });

  const coreModel = model.internalModel.coreModel;

  coreModel.addParameterValueById("ParamNairastraToggle18", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle66", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle65", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle16", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle15", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle55", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle59", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle60", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle62", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle67", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle68", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle56", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle58", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle73", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle50", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle25", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle51", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle26", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle17", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle52", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle19", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle27", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle28", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle34", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle35", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle36", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle24", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle64", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle29", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle30", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle31", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle33", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle32", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle20", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle21", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle22", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle23", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle45", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle46", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle53", 1.0);
  coreModel.addParameterValueById("ParamNairastraToggle70", 1.0);
})();
